<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <meta name="google-signin-client_id" content="307551660531-edetdp742dlq1fbhicnom5365ctfv8s8.apps.googleusercontent.com">
        <link rel="stylesheet" href="./public/css/style.css" />
        <title>SquareMatch</title>
    </head>
    <body>

        <div id="fb-root"></div>
        <div id="status-div">
            <div id="status"></div>
            <button id="status-close">x</button>
        </div>
        <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v5.0&appId=1294071634127793&autoLogAppEvents=1"></script>
        <script src="https://apis.google.com/js/platform.js" async defer></script>

        <script>
            window.fbAsyncInit = function() {
            FB.init({
                appId      : 'squarematch',
                cookie     : true,
                xfbml      : true,
                version    : 'v5.0'
            });
                
            FB.AppEvents.logPageView();
            checkLoginState();   
                
            };
        
            (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));

            function statusChangeCallback(response) {
                if (response.status === 'connected') {
                    document.getElementById("status").innerHTML = `Logged in as ${response.name}`;
                    document.getElementById("status-div").style = "display: flex"
                } else {
                    document.getElementById("status").innerHTML = `Log in!`;
                }
            }
            
            function checkLoginState() {
                FB.getLoginStatus(function(response) {
                    statusChangeCallback(response);
                });
            }
        </script>

        <div id="content">
            <header>
                <div id="title">SquareMatch</div>
                <div id="prompt-click">Click on a square to start!</div>
                <div id="prompt-trace" style="display: none"></div>
            </header>
            <div class="btn-wrapper">
                <a id="click" href="./index.html"><button id="reset">Reset</button></a>
                <div id="timer">00:00:00</div>
                <span id="how-to-play">How to play</span>
                <div id="help-menu">
                    <span>There are two game modes: Click and Trace. In both game modes the goal is the same: convert all of the squares to the same color as fast as you can.</span>
                    <span><br></span>
                    <span>Squares will change color randomly as you click on or trace over them, respectively. The counter in the squares' centers will keep track of how many squares you need to convert to win.</span>
                    <span><br></span>
                    <span>The reset button will restart your game at any time and start a new game once you finish. Sign in to keep track of your fastest times!</span>
                </div>
                <div class="toggle-wrapper">
                    Toggle: 
                    <a href="./index.html">Click</a>
                    /
                    <a href="./trace.html">Trace</a>
                </div>
            </div>
            <div id="squares">
                <div class="square" state="" init="rgba(200, 0, 0, 1)" n="0">
                    16
                </div>
                <div class="square" state="" init="rgba(0, 200, 0, 1)" n="1">
                    16
                </div>
                <div class="square" state="" init="rgba(0, 0, 200, 1)" n="2">
                    16
                </div>
                <div class="square" state="" init="rgba(200, 200, 0, 1)" n="3">
                    16
                </div>
                <div class="square" state="" init="rgba(200, 0, 200, 1)" n="4">
                    16
                </div>
                <div class="square" state="" init="rgba(0, 200, 200, 1)" n="5">
                    16
                </div>
                <div class="square" state="" init="rgba(200, 0, 0, 1)" n="6">
                    16
                </div>
                <div class="square" state="" init="rgba(0, 200, 0, 1)" n="7">
                    16
                </div>
                <div class="square" state="" init="rgba(0, 0, 200, 1)" n="8">
                    16
                </div>
                <div class="square" state="" init="rgba(200, 200, 0, 1)" n="9">
                    16
                </div>
                <div class="square" state="" init="rgba(200, 0, 200, 1)" n="10">
                    16
                </div>
                <div class="square" state="" init="rgba(0, 200, 200, 1)" n="11">
                    16
                </div>
                <div class="square" state="" init="rgba(200, 0, 0, 1)" n="12">
                    16
                </div>
                <div class="square" state="" init="rgba(0, 200, 0, 1)" n="13">
                    16
                </div>
                <div class="square" state="" init="rgba(0, 0, 200, 1)" n="14">
                    16
                </div>
                <div class="square" state="" init="rgba(200, 200, 0, 1)" n="15">
                    16
                </div>
            </div>
            <div id="victoryMsgBox">
                <div id="victoryMsg">Victory!</div>
                <div id="victoryTime">Finished in:</div>
                <div id="recordTime">Best Time:</div>
            </div>
            <div id="squares-remaining">Squares Remaining: 16</div>
        </div>
        <footer>
            <div id="copyright">Copyright Â©2020; SquareMatch @squarematch.xyz</div>
            <div id="me">Nick Barak</div>
        </footer>

        <div class="fb-login-button" style="position: absolute; top: 49px; right: 12.3%;" data-width="" data-size="medium" data-button-type="continue_with" data-auto-logout-link="true" data-use-continue-as="false"></div>
        <div class="g-signin2" style="height: 27px; width: 98px; position: absolute; top: 13px; right: 12.3%;" data-onsuccess="onSignIn"></div>
        <a class="googleSignOut" href="#" onclick="signOut();">Sign out</a>

        <script>
            function signOut() {
              var auth2 = gapi.auth2.getAuthInstance();
              auth2.signOut().then(function () {
                console.log('User signed out.');
              });
            }

            function onSignIn(googleUser) {
                let profile = googleUser.getBasicProfile();
                let id_token = googleUser.getAuthResponse().id_token;
                document.getElementById("status").innerHTML = `Logged in as ${profile.getName()}`;
                document.getElementById("status-div").style = "display: flex"
            }

            const xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://localhost:1000');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function() {
                console.log('Signed in as: ' + xhr.responseText);
            };
            xhr.send('idtoken=' + id_token);

        </script>
          

        <script type="text/JavaScript" src="./public/js/main.js"></script>

    </body>
</html>